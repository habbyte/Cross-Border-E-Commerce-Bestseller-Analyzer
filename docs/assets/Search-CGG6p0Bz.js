import{_ as ee,r as E,c as u,o as i,a as s,t as n,j as _,v as te,k as oe,l as P,F as w,e as S,m as N,f as se,b as ae,p as re,u as ne,q as le,g as ie,s as y,x as ce,h as g,P as k,y as W}from"./index-Bl43pGE1.js";import{P as de}from"./ProductCard-DW-INgZd.js";import{D as ue}from"./DataTable-DGv7cvp3.js";const me=o=>o==="low"?30:o==="medium"?60:100,he=o=>{if(!o)return[null,null];if(o==="200+")return[200,null];const[r,h]=o.split("-").map(Number);return[Number.isFinite(r)?r:null,Number.isFinite(h)?h:null]},D=o=>typeof o.sales=="number"?o.sales:Math.round(o.marginRate*25+150),F=o=>{if(typeof o.rating=="number")return o.rating;const r=4.8-o.competitionScore/100*1.5;return Number(Math.max(3,Math.min(5,r)).toFixed(1))},ge={name:"Search",components:{ProductCard:de,DataTable:ue},setup(){const o=ne(),{t:r}=le(),h=ie(),e=[k.AMAZON,k.SHOPEE,k.LAZADA,k.EBAY,k.ALIEXPRESS],C=y(""),c=ce({platform:"",category:"",priceRange:"",competition:""}),f=y("relevance"),v=y("desc"),a=y("grid"),p=y(1),b=y(12),L=g(()=>h.loading),I=g(()=>[{key:"title",label:r("search.table.name"),sortable:!0},{key:"platform",label:r("search.table.platform"),sortable:!0},{key:"formattedPrice",label:r("search.table.price"),sortable:!0},{key:"sales",label:r("search.table.sales"),sortable:!0},{key:"rating",label:r("search.table.rating"),sortable:!0},{key:"competition",label:r("search.table.competition"),sortable:!0}]),U=g(()=>{const t=Array.from(new Set(h.products.map(l=>l.platform)));return Array.from(new Set([...e,...t]))}),M=t=>{const l=`settings.platforms.${t}`,d=r(l);return d===l?t:d},Q=g(()=>{const t=new Set(h.products.map(l=>l.category));return Array.from(t)}),B=g(()=>{const[t,l]=he(c.priceRange);return h.searchProducts(C.value,{platform:c.platform||"all",category:c.category||"all",minMargin:0,maxCompetition:me(c.competition)}).filter(m=>!(t!==null&&m.price<t||l!==null&&m.price>l))}),R=g(()=>{const t=[...B.value],l=v.value==="asc"?1:-1;switch(f.value){case"sales":return t.sort((d,m)=>(D(d)-D(m))*l);case"price":return t.sort((d,m)=>(d.price-m.price)*l);case"rating":return t.sort((d,m)=>(F(d)-F(m))*l);case"competition":return t.sort((d,m)=>(d.competitionScore-m.competitionScore)*l);default:return t}}),T=g(()=>Math.max(1,Math.ceil(R.value.length/b.value))),O=g(()=>{const t=(p.value-1)*b.value;return R.value.slice(t,t+b.value)}),q=g(()=>R.value.map(t=>({id:t.id,title:t.title,platform:M(t.platform),formattedPrice:t.formattedPrice,sales:D(t),rating:F(t),competition:t.competitionLevel}))),z=g(()=>{const t=(p.value-1)*b.value;return q.value.slice(t,t+b.value)}),K=g(()=>{const t=[],l=T.value,d=p.value,m=2,$=Math.max(1,d-m),x=Math.min(l,d+m);for(let A=$;A<=x;A+=1)t.push(A);return t}),V=()=>{p.value=1},Z=()=>{c.platform="",c.category="",c.priceRange="",c.competition="",V()},j=()=>{a.value=a.value==="grid"?"table":"grid"},H=t=>{t>=1&&t<=T.value&&(p.value=t)},X=t=>{const l=typeof t=="string"?t:t==null?void 0:t.id;l&&o.push(`/products/${l}`)},Y=t=>{try{h.toggleWatch(t)}catch(l){console.error("Failed to toggle watchlist:",l)}},G=t=>{try{h.addToCompare(t)}catch(l){console.error("Failed to add product to compare:",l)}},J=({key:t,order:l})=>{f.value=t,v.value=l==="asc"?"asc":"desc",p.value=1};return W([C,()=>c.platform,()=>c.category,()=>c.priceRange,()=>c.competition],()=>{p.value=1}),W(f,(t,l)=>{t==="relevance"?v.value="desc":(t==="price"||t==="competition")&&t!==l?v.value="asc":t!==l&&(v.value="desc")}),{t:r,loading:L,searchQuery:C,filters:c,sortBy:f,sortOrder:v,viewMode:a,currentPage:p,pageSize:b,tableColumns:I,platforms:U,categories:Q,filteredProducts:B,paginatedProducts:O,paginatedTableRows:z,totalPages:T,visiblePages:K,handleSearch:V,clearFilters:Z,toggleView:j,goToPage:H,viewProductDetails:X,toggleWatch:Y,addToCompare:G,handleSort:J,translatePlatform:M,isWatched:h.isWatched,isInCompare:h.isInCompare}}},pe={class:"search-page"},ve={class:"page-header"},fe={class:"page-title"},be={class:"page-subtitle"},_e={class:"search-section"},ye={class:"search-form"},Pe={class:"search-input-group"},ke=["placeholder"],Ce=["disabled"],we={class:"filters"},Se={class:"filter-group"},Re={class:"filter-label"},Te={value:""},Ae=["value"],De={class:"filter-group"},Fe={class:"filter-label"},Me={value:""},Be=["value"],Ve={class:"filter-group"},Ee={class:"filter-label"},Ne={value:""},We={value:"0-50"},Le={value:"50-100"},Ie={value:"100-200"},Ue={value:"200+"},Qe={class:"filter-group"},Oe={class:"filter-label"},qe={value:""},ze={value:"low"},Ke={value:"medium"},Ze={value:"high"},je={class:"results-section"},He={class:"results-header"},Xe={class:"results-info"},Ye={class:"results-count"},Ge={key:0,class:"search-term"},Je={class:"results-actions"},$e={value:"relevance"},xe={value:"sales"},et={value:"price"},tt={value:"rating"},ot={value:"competition"},st={key:0,class:"results-content"},at={key:0,class:"products-grid"},rt={key:1,class:"products-table"},nt={key:2,class:"pagination"},lt=["disabled"],it={class:"page-numbers"},ct=["onClick"],dt=["disabled"],ut={key:1,class:"empty-results"},mt={class:"empty-title"},ht={class:"empty-text"};function gt(o,r,h,e,C,c){const f=E("ProductCard"),v=E("DataTable");return i(),u("div",pe,[s("div",ve,[s("h1",fe,n(o.$t("search.title")),1),s("p",be,n(o.$t("search.subtitle")),1)]),s("div",_e,[s("div",ye,[s("div",Pe,[_(s("input",{"onUpdate:modelValue":r[0]||(r[0]=a=>e.searchQuery=a),type:"text",class:"form-input search-input",placeholder:o.$t("search.placeholder"),onKeyup:r[1]||(r[1]=oe((...a)=>e.handleSearch&&e.handleSearch(...a),["enter"]))},null,40,ke),[[te,e.searchQuery]]),s("button",{class:"btn btn-primary search-btn",disabled:e.loading,onClick:r[2]||(r[2]=(...a)=>e.handleSearch&&e.handleSearch(...a))},n(e.loading?o.$t("search.searching"):o.$t("search.searchButton")),9,Ce)]),s("div",we,[s("div",Se,[s("label",Re,n(o.$t("search.platform")),1),_(s("select",{"onUpdate:modelValue":r[3]||(r[3]=a=>e.filters.platform=a),class:"form-select"},[s("option",Te,n(o.$t("search.allPlatforms")),1),(i(!0),u(w,null,S(e.platforms,a=>(i(),u("option",{key:a,value:a},n(e.translatePlatform(a)),9,Ae))),128))],512),[[P,e.filters.platform]])]),s("div",De,[s("label",Fe,n(o.$t("search.category")),1),_(s("select",{"onUpdate:modelValue":r[4]||(r[4]=a=>e.filters.category=a),class:"form-select"},[s("option",Me,n(o.$t("search.allCategories")),1),(i(!0),u(w,null,S(e.categories,a=>(i(),u("option",{key:a,value:a},n(a),9,Be))),128))],512),[[P,e.filters.category]])]),s("div",Ve,[s("label",Ee,n(o.$t("search.priceRange")),1),_(s("select",{"onUpdate:modelValue":r[5]||(r[5]=a=>e.filters.priceRange=a),class:"form-select"},[s("option",Ne,n(o.$t("search.noPriceLimit")),1),s("option",We,n(o.$t("search.priceRanges.range0_50")),1),s("option",Le,n(o.$t("search.priceRanges.range50_100")),1),s("option",Ie,n(o.$t("search.priceRanges.range100_200")),1),s("option",Ue,n(o.$t("search.priceRanges.range200_plus")),1)],512),[[P,e.filters.priceRange]])]),s("div",Qe,[s("label",Oe,n(o.$t("search.competition")),1),_(s("select",{"onUpdate:modelValue":r[6]||(r[6]=a=>e.filters.competition=a),class:"form-select"},[s("option",qe,n(o.$t("common.all")),1),s("option",ze,n(o.$t("productDetail.competition.low")),1),s("option",Ke,n(o.$t("productDetail.competition.medium")),1),s("option",Ze,n(o.$t("productDetail.competition.high")),1)],512),[[P,e.filters.competition]])]),s("button",{class:"btn btn-secondary",onClick:r[7]||(r[7]=(...a)=>e.clearFilters&&e.clearFilters(...a))},n(o.$t("search.clearFilters")),1)])])]),s("div",je,[s("div",He,[s("div",Xe,[s("span",Ye,n(o.$t("search.resultsCount",{count:e.filteredProducts.length})),1),e.searchQuery?(i(),u("span",Ge,n(o.$t("search.keyword"))+': "'+n(e.searchQuery)+'" ',1)):N("",!0)]),s("div",Je,[_(s("select",{"onUpdate:modelValue":r[8]||(r[8]=a=>e.sortBy=a),class:"form-select"},[s("option",$e,n(o.$t("search.sortBy.relevance")),1),s("option",xe,n(o.$t("search.sortBy.sales")),1),s("option",et,n(o.$t("search.sortBy.price")),1),s("option",tt,n(o.$t("search.sortBy.rating")),1),s("option",ot,n(o.$t("search.sortBy.competition")),1)],512),[[P,e.sortBy]]),s("button",{class:"btn btn-ghost view-toggle",onClick:r[9]||(r[9]=(...a)=>e.toggleView&&e.toggleView(...a))},n(e.viewMode==="grid"?"ðŸ“‹":"ðŸ—‚ï¸"),1)])]),e.filteredProducts.length>0?(i(),u("div",st,[e.viewMode==="grid"?(i(),u("div",at,[(i(!0),u(w,null,S(e.paginatedProducts,a=>(i(),se(f,{key:a.id,product:a,"is-watched":e.isWatched(a.id),"is-in-compare":e.isInCompare(a.id),onViewDetails:e.viewProductDetails,onAddToWatch:e.toggleWatch,onAddToCompare:e.addToCompare},null,8,["product","is-watched","is-in-compare","onViewDetails","onAddToWatch","onAddToCompare"]))),128))])):(i(),u("div",rt,[ae(v,{title:"",columns:e.tableColumns,data:e.paginatedTableRows,"empty-text":o.$t("search.noResults"),onRowClick:e.viewProductDetails,onSortChange:e.handleSort},null,8,["columns","data","empty-text","onRowClick","onSortChange"])])),e.totalPages>1?(i(),u("div",nt,[s("button",{class:"btn btn-ghost",disabled:e.currentPage===1,onClick:r[10]||(r[10]=a=>e.goToPage(e.currentPage-1))},n(o.$t("common.previous")),9,lt),s("div",it,[(i(!0),u(w,null,S(e.visiblePages,a=>(i(),u("button",{key:a,class:re(["btn",a===e.currentPage?"btn-primary":"btn-ghost"]),onClick:p=>e.goToPage(a)},n(a),11,ct))),128))]),s("button",{class:"btn btn-ghost",disabled:e.currentPage===e.totalPages,onClick:r[11]||(r[11]=a=>e.goToPage(e.currentPage+1))},n(o.$t("common.next")),9,dt)])):N("",!0)])):(i(),u("div",ut,[r[13]||(r[13]=s("div",{class:"empty-icon"}," é¦ƒæ”³ ",-1)),s("div",mt,n(o.$t("search.noResults")),1),s("div",ht,n(o.$t("search.noResultsDesc")),1),s("button",{class:"btn btn-primary",onClick:r[12]||(r[12]=(...a)=>e.clearFilters&&e.clearFilters(...a))},n(o.$t("search.clearAllFilters")),1)]))])])}const bt=ee(ge,[["render",gt],["__scopeId","data-v-66dec891"]]);export{bt as default};
